parameters:
  appcenterAndroid: ''
  appcenterIOS: ''
  secretsFilePath: ''

steps:
- powershell: |
    $json = @{ 
      AppCenter= @{ 
        iOS = "${env:IOS}"
        Android = "${env.ANDROID}" 
      } 
    }
    $json | ConvertTo-Json -Compress | Out-File -FilePath "$(Build.SourcesDirectory)\${env:SECRETS_PATH}" -Encoding ASCII; exit $LASTEXITCODE
  env:
    ANDROID: ${{ parameters.appcenterAndroid }}
    IOS: ${{ parameters.appcenterIOS }}
    SECRETS_PATH: ${{ parameters.secretsFilePath }}
  displayName: 'Generate Proudction App Secrets'
  condition: and(succeeded(), ne('${{ parameters.secretsFilePath }}', ''), ne('${{ parameters.appcenterAndroid }}', ''), ne('${{ parameters.appcenterIOS }}', ''), eq(variables['System.PullRequest.IsFork'], 'false'), ne('${{ parameters.appcenterIOSSecret }}', ''), ne('${{ parameters.appcenterAndroidSecret }}', ''))

- powershell: '"{}" | Out-File -FilePath "$(Build.SourcesDirectory)\${env:SECRETS_PATH}" -Encoding ASCII; exit $LASTEXITCODE'
  env:
    SECRETS_PATH: ${{ parameters.secretsFilePath }}
  displayName: 'Generate Empty App Secrets'
  condition: and(succeeded(), eq(variables['System.PullRequest.IsFork'], 'true'), ne('${{ parameters.appcenterIOSSecret }}', ''), ne('${{ parameters.appcenterAndroidSecret }}', ''))